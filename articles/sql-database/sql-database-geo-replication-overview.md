<properties
	pageTitle="Replicación geográfica activa para Base de datos SQL de Azure"
	description="En este tema se explica Replicación geográfica activa para Base de datos SQL y sus usos."
	services="sql-database"
	documentationCenter="na"
	authors="rothja"
	manager="jeffreyg"
	editor="monicar" />


<tags
	ms.service="sql-database"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="data-management"
	ms.date="03/07/2016"
	ms.author="jroth" />

# Replicación geográfica activa para Base de datos SQL de Azure

## Información general
La característica Replicación geográfica activa implementa un mecanismo para proporcionar redundancia de base de datos en la misma región de Microsoft Azure o en distintas regiones (redundancia geográfica). Replicación geográfica activa replica de forma asincrónica las transacciones confirmadas desde una base de datos en hasta cuatro copias de la base de datos en servidores diferentes. Cuando se configura la replicación geográfica activa, se crea una base de datos secundaria en el servidor especificado y la base de datos original se convierte en la principal. La base de datos principal replica de forma asincrónica las transacciones confirmadas en cada una de las bases de datos secundarias. Aunque, en un momento dado, la base de datos secundaria puede estar algo retrasada respecto a la principal, se garantiza que los datos secundarios guarden siempre coherencia transaccional con los confirmados en la base de datos principal.

Una de las principales ventajas de la replicación geográfica activa es que ofrece una solución de recuperación ante desastres en el nivel de base de datos con un tiempo de recuperación muy reducido. Cuando se coloca la base de datos secundaria en un servidor de una región distinta, se agrega la máxima resistencia a la aplicación. La redundancia entre regiones permite que las aplicaciones se recuperen de la pérdida permanente de todo un centro de datos, o de partes de él, causada por desastres naturales, errores humanos catastróficos o actos malintencionados. En la siguiente ilustración, se muestra un ejemplo de replicación geográfica activa configurada en una base de datos Premium con una base de datos principal en la región Oeste de EE. UU. y una secundaria en la región Este de EE. UU.

![Relación de replicación geográfica](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

Otra ventaja clave es que las bases de datos secundarias son legibles y se pueden usar para descargar cargas de trabajo de solo lectura como trabajos de informes. Si solo va a usar la base de datos secundaria para el equilibrio de carga, puede crearla en la misma región que la principal, pero esto no aumentará resistencia de la aplicación ante errores catastróficos.

Algunos otros escenarios donde se puede usar Replicación geográfica activa son:

- **Migración de base de datos**: puede usar Replicación geográfica activa para migrar una base de datos de un servidor a otro en línea con un tiempo de inactividad mínimo.
- **Actualizaciones de aplicaciones**: puede crear una base de datos secundaria adicional como copia de conmutación por recuperación durante las actualizaciones de la aplicación.

Para lograr una verdadera continuidad empresarial, agregar redundancia de base de datos entre centros de datos es solo parte de la solución. Para recuperar una aplicación (un servicio) de un extremo a otro tras un error catastrófico, es necesario recuperar todos los componentes que constituyen el servicio y cualquier servicio dependiente. Algunos ejemplos de estos componentes son el software cliente (por ejemplo, un explorador con JavaScript personalizado), los front-end web, el almacenamiento y DNS. Es fundamental que todos los componentes sean resistentes a los mismos errores y que estén disponibles en el plazo del objetivo de tiempo de recuperación (RTO) de la aplicación. Por lo tanto, debe identificar todos los servicios dependientes y comprender las garantías y capacidades que ofrecen. A continuación, debe seguir los pasos adecuados para asegurarse de que el servicio funcione durante la conmutación por error de los servicios de los que depende. Para obtener más información sobre el diseño de soluciones para la recuperación ante desastres, consulte [Diseño de aplicaciones de nube para la continuidad de negocio mediante replicación geográfica](sql-database-designing-cloud-solutions-for-disaster-recovery.md).

## Funcionalidad de replicación geográfica activa
La característica Replicación geográfica activa ofrece la funcionalidad esencial siguiente:

- **Replicación asincrónica automática**: solo se puede crear una base de datos secundaria mediante la adición a una existente. La base de datos secundaria solo se puede crear en un servidor de Base de datos SQL de Azure diferente. Una vez creada, la base de datos secundaria se rellena con los datos copiados de la base de datos principal. Este proceso se conoce como propagación. Después de crear y propagar la base de datos secundaria, las actualizaciones de la base de datos principal se replican asincrónicamente en la base de datos secundaria de forma automática. Esto significa que las transacciones se confirman en la base de datos principal antes de replicarse en la secundaria. Base de datos SQL garantiza que, una vez completada la propagación, la base de datos secundaria mantiene la coherencia transaccional en todo momento. Para más información sobre la creación de la base de datos secundaria, consulte [Configuración de la replicación geográfica para Base de datos SQL de Azure con Transact-SQL](sql-database-geo-replication-transact-sql.md) y [Configuración de la replicación geográfica para Base de datos SQL de Azure con PowerShell](sql-database-geo-replication-powershell.md). Consulte [Configuración de replicación geográfica para Base de datos SQL de Azure con el Portal de Azure](sql-database-geo-replication-portal.md) para detalles de la creación de la base de datos secundaria mediante el Portal de Azure.

- **Varias bases de datos secundarias**: dos o más bases de datos secundarias aumentan la redundancia y el nivel de protección de la base de datos principal y la aplicación. Si existen varias bases de datos secundarias, la aplicación seguirá estando protegida incluso si se produce un error en una de ellas. Si solo hay una base de datos secundaria y se produce un error, la aplicación está expuesta a un mayor riesgo hasta que se crea una nueva base de datos secundaria.

- **Bases de datos secundarias legibles**: una aplicación puede acceder a una base de datos secundaria para operaciones de solo lectura con las mismas entidades de seguridad que las usadas para acceder a la base de datos principal u otras diferentes. Las bases de datos secundarias funcionan en el modo de aislamiento de instantánea para asegurarse de que no se retrasa la replicación de las actualizaciones de la base de datos principal (reproducción de registro) por las consultas ejecutadas en la secundaria.

>[AZURE.NOTE] La reproducción de registro se retrasará en la base de datos secundaria si está recibiendo actualizaciones de esquema desde la principal, ya que esto requiere un bloqueo de esquema en la base de datos secundaria.

- **Replicación geográfica activa de bases de datos del grupo elástico**: se puede configurar la replicación geográfica activa para cualquier base de datos en un grupo de bases de datos elásticas Premium. La base de datos secundaria puede estar en otro grupo de bases de datos elásticas Premium. Para las bases de datos normales, la base de datos secundaria puede ser un grupo de bases de datos elásticas y viceversa, siempre que los niveles de servicio sean los mismos. Para detalles sobre cómo configurar la replicación geográfica para las bases de datos del grupo elástico, consulte [Configuración de la replicación geográfica para Base de datos SQL de Azure con Transact-SQL](sql-database-geo-replication-transact-sql.md) y [Configuración de la replicación geográfica para Base de datos SQL de Azure con PowerShell](sql-database-geo-replication-powershell.md).  

- **Nivel de rendimiento configurable de la base de datos secundaria**: se puede crear una base de datos secundaria con un nivel de rendimiento inferior al de la principal. Es necesario que tanto la base de datos principal como las secundarias tengan el mismo nivel de servicio. No se recomienda esta opción para las aplicaciones con elevada actividad de escritura en la base de datos, ya que puede causar mayores retrasos de replicación y, por lo tanto, hay un gran riesgo de una pérdida considerable de datos después de la conmutación por error. Además, después de la conmutación por error, el rendimiento de la aplicación se verá afectado hasta que la nueva base de datos principal se actualice a un nivel de rendimiento mayor. El gráfico de porcentaje de E/S de registro en el Portal de Azure proporciona un buen método para estimar el nivel mínimo de rendimiento de la base de datos secundaria que será necesario para mantener la carga de replicación. Por ejemplo, si la base de datos principal es P6 (1000 DTU) y su porcentaje de E/S de registro es 50 %, la base de datos secundaria debe ser al menos P4 (500 DTU). También puede recuperar los datos de E/S de registro mediante las vistas de base de datos [sys.resource\_stats](https://msdn.microsoft.com/library/dn269979.aspx) o [sys.dm\_db\_resource\_stats](https://msdn.microsoft.com/library/dn800981.aspx). Para más información sobre los niveles de rendimiento de Base de datos SQL, consulte [Opciones y rendimiento de Base de datos SQL](sql-database-service-tiers.md). Para detalles sobre cómo configurar el nivel de rendimiento de los ejemplos de base de datos secundaria, consulte [Configuración de la replicación geográfica para Base de datos SQL de Azure con Transact-SQL](sql-database-geo-replication-transact-sql.md) y [Configuración de la replicación geográfica para Base de datos SQL de Azure con PowerShell](sql-database-geo-replication-powershell.md).

- **Conmutación por error y conmutación por recuperación controladas por el usuario**: se puede cambiar una base de datos secundaria al rol principal en cualquier momento mediante una acción explícita de la aplicación o el usuario. Durante una interrupción real, debe utilizarse la opción "no planeada", que promoverá inmediatamente una base de datos secundaria a principal. Cuando la base de datos principal que generó el error se recupera y vuelve a estar disponible, el sistema la marca automáticamente como base de datos secundaria y la pone al día con la nueva base de datos principal. Por la naturaleza asincrónica de la replicación, se puede perder una pequeña cantidad de datos durante las conmutaciones por error no planeadas antes de que se repliquen los cambios más recientes a la base de datos secundaria. Cuando una base de datos principal con varias secundarias conmuta por error, el sistema vuelve a configurar automáticamente las relaciones de replicación y vincula las bases de datos secundarias restantes a la principal recién promovida sin necesidad de que intervenga el usuario. Una vez que se mitiga la interrupción que causó la conmutación por error, sería conveniente devolver la aplicación a la región primaria. Para hacer esto, se debe invocar el comando de conmutación por error con la opción "planeada". Para más información sobre cómo activar la conmutación por error mediante T-SQL, consulte [Configuración de la replicación geográfica para Base de datos SQL de Azure con Transact-SQL](sql-database-geo-replication-transact-sql.md). Para más información sobre cómo activar la conmutación por error mediante PowerShell, consulte [Configuración de la replicación geográfica para Base de datos SQL de Azure con PowerShell](sql-database-geo-replication-powershell.md).

- **Mantenimiento de las credenciales y las reglas de firewall sincronizadas**: se recomienda usar las [reglas de firewall de base de datos](sql-database-firewall-configure.md) para las bases de datos con replicación geográfica. Así estas reglas se pueden replicar con la base de datos para asegurarse de todas las bases de datos secundarias tengan la misma configuración de firewall que la principal. Esto elimina la necesidad de que los clientes configuren y mantengan manualmente las reglas de firewall en los servidores que hospedan tanto la base de datos principal como las secundarias. Igualmente, utilizar [usuarios de base de datos independiente](sql-database-manage-logins.md) para el acceso a los datos garantiza que la base de datos principal y las secundarias tengan siempre las mismas credenciales de usuario. Por tanto, en caso de conmutaciones por error, no habrá interrupciones debidas a una discrepancia en los inicios de sesión y las contraseñas. Con la adición de [Azure Active Directory](../active-directory/active-directory-whatis.md), los clientes pueden administrar el acceso de usuarios a la base de datos principal y a las secundarias, por lo que ya no es necesario administrar credenciales en las bases de datos.

- **API de Azure Resource Manager y seguridad basada en roles**: la replicación geográfica activa incluye un conjunto de [API de Azure Resource Manager (ARM)](https://msdn.microsoft.com/library/azure/mt163571.aspx) para la administración, incluidos [cmdlets de PowerShell basados en ARM](sql-database-geo-replication-powershell.md). Estas API requieren que se usen grupos de recursos y admiten la seguridad basada en roles (RBAC). Para más información sobre cómo implementar los roles de acceso, consulte [Control de acceso basado en roles de Azure](../active-directory/role-based-access-control-configure.md).

>[AZURE.NOTE] La [API de REST de administración de servicios de SQL Azure (clásica)](https://msdn.microsoft.com/library/azure/dn505719.aspx) y los [cmdlets de Base de datos SQL de Azure (clásicos)](https://msdn.microsoft.com/library/azure/dn546723.aspx) existentes se admiten por compatibilidad con versiones anteriores. Sin embargo, muchas de las nuevas características de la replicación geográfica activa solo se admiten en la [API de REST de Azure SQL](https://msdn.microsoft.com/library/azure/mt163571.aspx) basada en ARM y en los [cmdlets de PowerShell de Base de datos SQL de Azure](https://msdn.microsoft.com/library/azure/mt574084.aspx) basados en ARM.

## Evitar la pérdida de datos críticos
Debido a la elevada latencia de las redes de área extensa, la copia continua usa un mecanismo de replicación asincrónica. Esto hace inevitable cierta pérdida de datos si se produce un error. Sin embargo, es posible que algunas aplicaciones exijan que no se pierdan datos. Para proteger estas actualizaciones críticas, un desarrollador de aplicaciones puede llamar al procedimiento del sistema [sp\_wait\_for\_database\_copy\_sync](https://msdn.microsoft.com/library/dn467644.aspx) inmediatamente después de confirmar la transacción. La llamada a **sp\_wait\_for\_database\_copy\_sync** bloquea el subproceso de llamada hasta que se replica la última transacción confirmada en la base de datos secundaria. El procedimiento esperará hasta que la base de datos secundaria confirme todas las transacciones en cola. El ámbito de **sp\_wait\_for\_database\_copy\_sync** es un vínculo de copia continua específico. Cualquier usuario con derechos de conexión para la base de datos principal puede llamar a este procedimiento.

>[AZURE.NOTE] El retraso causado por una llamada al procedimiento **sp\_wait\_for\_database\_copy\_sync** puede ser considerable. El retraso depende de la longitud del registro de transacciones en ese momento y no se devolverán resultados hasta que se replique el registro completo. Evite llamar a este procedimiento a menos que sea absolutamente necesario.

## Pasos siguientes
Para más información sobre otras características de continuidad empresarial de Base de datos SQL, consulte [Información general: continuidad del negocio en la nube y recuperación ante desastres con Base de datos SQL](sql-database-business-continuity.md).

<!---HONumber=AcomDC_0309_2016-->